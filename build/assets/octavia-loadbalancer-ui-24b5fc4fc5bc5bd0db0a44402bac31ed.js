//# sourceMappingURL=octavia-loadbalancer-ui.js.map
const csrfToken=()=>{const c=document.querySelector('meta[name="csrf-token"]')||document.querySelector('meta[name="_csrf"]');return c?c.getAttribute("content"):null},csrfHeaderName=()=>{const c=document.querySelector('meta[name="_csrf_header"]');return c?c.getAttribute("content"):"X-CSRF-TOKEN"},cookieVal=c=>(c=document.cookie.match(new RegExp("(^|; )"+c.replace(/([.*+?^${}()|[\]\\])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(c[2]):null,apiFetch=(c,a={})=>{const b={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};
a.body&&(b["Content-Type"]="application/json");var d=csrfToken();if(d){const e=csrfHeaderName();b[e]=d;b["X-CSRF-TOKEN"]=d}if(d=cookieVal("XSRF-TOKEN"))b["X-XSRF-TOKEN"]=d,b["X-CSRF-TOKEN"]||(b["X-CSRF-TOKEN"]=d);a=Object.assign({credentials:"include",headers:b},a);return fetch(c,a).then(async e=>{var h=await e.text();if(h)try{var f=JSON.parse(h)}catch(l){f={raw:h}}else f={};h=f;if(!e.ok)throw Error(h?.message||h?.error||`Request failed (${e.status})`);return h})},useAsync=(c,a)=>{const [b,d]=React.useState({loading:!0});
React.useEffect(()=>{let e=!0;d({loading:!0});c().then(h=>e&&d({loading:!1,data:h})).catch(h=>e&&d({loading:!1,error:h}));return()=>{e=!1}},a);return b},Badge=({text:c,tone:a="info"})=>React.createElement("span",{className:`label label-${a}`,style:{marginRight:6}},c),Field=({label:c,children:a,help:b,required:d})=>React.createElement("div",{className:"form-group"},React.createElement("label",{className:"control-label"},c,d?React.createElement("span",{className:"text-danger"}," *"):null),a,b?React.createElement("div",
{className:"help-block"},b):null),makeApi=c=>{const a=`/plugin/${c}`;return{listLoadBalancers:({networkId:b,instanceId:d})=>apiFetch(`${a}/loadbalancers?${b?"networkId="+b:"instanceId="+d}`),listOptions:b=>Promise.all([apiFetch(`${a}/options/projects?networkId=${b}`),apiFetch(`${a}/options/subnets?networkId=${b}`),apiFetch(`${a}/options/instances?networkId=${b}`),apiFetch(`${a}/options/floatingIpPools?networkId=${b}`)]).then(([d,e,h,f])=>{const l=(g,k)=>Array.isArray(g)?g:g&&g[k]?g[k]:[];return{projects:l(d,
"projects"),subnets:l(e,"subnets"),instances:l(h,"instances"),fipPools:l(f,"floatingIpPools")}}),createLoadBalancer:b=>apiFetch(`${a}/loadbalancers/create`,{method:"POST",body:JSON.stringify(b)}),deleteLoadBalancer:(b,d)=>apiFetch(`${a}/loadbalancers/delete`,{method:"POST",body:JSON.stringify({lbId:b,networkId:d})}),attachFloatingIp:(b,d,e)=>apiFetch(`${a}/floatingip/attach`,{method:"POST",body:JSON.stringify({lbId:b,networkId:d,floatingIpPoolId:e})}),detachFloatingIp:(b,d)=>apiFetch(`${a}/floatingip/detach`,
{method:"POST",body:JSON.stringify({lbId:b,networkId:d})})}},mountNode=document.getElementById("octavia-loadbalancer-view"),pluginCode=mountNode?.dataset?.pluginCode||"octavia1234",Api=makeApi(pluginCode),MembersSelector=({options:c,selected:a,onChange:b})=>{const [d,e]=React.useState(""),h=c.filter(f=>!a.includes(f.value));return React.createElement("div",null,React.createElement("div",{className:"form-inline",style:{marginBottom:10}},React.createElement("select",{className:"form-control",value:d,
onChange:f=>e(f.target.value)},React.createElement("option",{value:!0},"Add instance..."),h.map(f=>React.createElement("option",{key:f.value,value:f.value},f.name))),React.createElement("button",{className:"btn btn-default",style:{marginLeft:8},disabled:!d,onClick:()=>{b([...a,d]);e("")}},"Add")),0===a.length?React.createElement("div",{className:"text-muted"},"No members selected"):React.createElement("ul",{className:"list-group"},a.map(f=>{const l=(c.find(g=>g.value===f)||{}).name||f;return React.createElement("li",
{key:f,className:"list-group-item"},l,React.createElement("button",{className:"btn btn-xs btn-link pull-right text-danger",onClick:()=>b(a.filter(g=>g!==f))},"remove"))})))},CreatePanel=({networkId:c,options:a,onCreated:b,onClose:d})=>{const [e,h]=React.useState({name:"",vipSubnetId:a.subnets&&a.subnets.length?a.subnets[0].value:"",members:[]});React.useEffect(()=>{a.subnets&&a.subnets.length&&!e.vipSubnetId&&h(k=>({...k,vipSubnetId:a.subnets[0].value}))},[a.subnets]);const [f,l]=React.useState(!1),
g=a.projects&&a.projects[0]?a.projects[0].name:"";return React.createElement("div",{className:"panel panel-default",style:{boxShadow:"0 12px 30px rgba(0,0,0,0.18)",borderRadius:12}},React.createElement("div",{className:"panel-heading"},React.createElement("h4",{className:"panel-title"},"Create Load Balancer"),React.createElement("button",{className:"close",onClick:d},"&times;")),React.createElement("div",{className:"panel-body"},React.createElement(Field,{label:"Name",required:!0},React.createElement("input",
{className:"form-control",value:e.name,onChange:k=>h({...e,name:k.target.value})})),React.createElement(Field,{label:"Project"},React.createElement("input",{className:"form-control",value:g,readOnly:!0})),React.createElement(Field,{label:"VIP Subnet",required:!0},React.createElement("select",{className:"form-control",value:e.vipSubnetId,onChange:k=>h({...e,vipSubnetId:k.target.value})},(a.subnets||[]).map(k=>React.createElement("option",{key:k.value,value:k.value},k.name,k.cidr?`(${k.cidr})`:"")))),
React.createElement(Field,{label:"Members"},React.createElement(MembersSelector,{options:a.instances||[],selected:e.members,onChange:k=>h({...e,members:k})})),React.createElement("div",{className:"text-right"},React.createElement("button",{className:"btn btn-default",onClick:d},"Cancel"),React.createElement("button",{className:"btn btn-primary",style:{marginLeft:8},onClick:()=>{if(!e.name||!e.vipSubnetId)return alert("Name and subnet are required");l(!0);Api.createLoadBalancer({...e,networkId:c}).then(()=>
{l(!1);b()}).catch(k=>{l(!1);alert(k?.message||"Create failed")})},disabled:f},f?"Creating...":"Create"))))},FloatingIpButton=({lb:c,networkId:a,pools:b,refresh:d})=>{const [e,h]=React.useState(!1),[f,l]=React.useState(b&&b.length?b[0].value:""),[g,k]=React.useState(!1),n=m=>{k(!0);m().then(d).catch(p=>alert(p.message)).finally(()=>k(!1))};return c.floatingIp?React.createElement("button",{className:"btn btn-warning btn-xs",disabled:g,onClick:()=>n(()=>Api.detachFloatingIp(c.id,a))},g?"Detaching...":
"Detach Floating IP"):React.createElement("div",{className:"btn-group"},React.createElement("button",{className:"btn btn-default btn-xs",disabled:g,onClick:()=>h(!e)},"Attach Floating IP"),e&&React.createElement("div",{style:{position:"absolute",background:"#fff",padding:8,border:"1px solid #ddd",zIndex:5}},React.createElement("select",{className:"form-control input-sm",value:f,onChange:m=>l(m.target.value),disabled:g},(b||[]).map(m=>React.createElement("option",{key:m.value,value:m.value},m.name))),
React.createElement("button",{className:"btn btn-primary btn-xs",style:{marginTop:6},disabled:g||!f,onClick:()=>n(()=>Api.attachFloatingIp(c.id,a,f))},g?"Attaching...":"Attach")))},NetworkView=({networkId:c})=>{const [a,b]=React.useState(!1);var d=useAsync(()=>Api.listOptions(c),[c,a]);const e=useAsync(()=>Api.listLoadBalancers({networkId:c}),[c,a]),[h,f]=React.useState(null);React.useEffect(()=>{e.data&&f(e.data)},[e]);if(e.error||d.error)return React.createElement("div",{className:"alert alert-danger"},
e.error?.message||d.error?.message||"Error loading data");if(e.loading||d.loading)return React.createElement("div",null,"Loading...");const l=d.data||{};d=h?h.loadbalancers||[]:[];return React.createElement("div",{className:"container-fluid",style:{padding:"0 12px"}},React.createElement("div",{className:"clearfix",style:{marginBottom:12}},React.createElement("button",{className:"btn btn-primary pull-right",onClick:()=>b(!0)},"Create Load Balancer"),React.createElement("h3",null,"Load Balancers on this Network")),
0===d.length?React.createElement("div",{className:"alert alert-info"},"No load balancers yet."):React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-striped table-condensed",style:{minWidth:600}},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"Project"),React.createElement("th",null,"Members"),React.createElement("th",null,"Floating IP"),React.createElement("th",
null))),React.createElement("tbody",null,d.map(g=>React.createElement("tr",{key:g.id},React.createElement("td",null,g.name),React.createElement("td",null,g.projectName||l.projects?.[0]?.name),React.createElement("td",null,(g.members||[]).length),React.createElement("td",null,g.floatingIp?g.floatingIp.ipAddress||"Attached":"None"),React.createElement("td",{className:"text-right"},React.createElement(FloatingIpButton,{lb:g,networkId:c,pools:l.fipPools||[],refresh:()=>Api.listLoadBalancers({networkId:c}).then(f)}),
React.createElement("button",{className:"btn btn-link text-danger btn-xs",style:{marginLeft:6},onClick:()=>Api.deleteLoadBalancer(g.id,c).then(()=>Api.listLoadBalancers({networkId:c}).then(f)).catch(k=>alert(k.message))},"Delete"))))))),a&&React.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15,15,30,0.45)",padding:"40px 10%",overflowY:"auto"}},React.createElement(CreatePanel,{networkId:c,options:l,onCreated:()=>{b(!1);Api.listLoadBalancers({networkId:c}).then(f)},
onClose:()=>b(!1)})))},InstanceView=({instanceId:c})=>{var a=useAsync(()=>Api.listLoadBalancers({instanceId:c}),[c]);if(a.error)return React.createElement("div",{className:"alert alert-danger"},a.error.message);if(a.loading)return React.createElement("div",null,"Loading...");a=a.data?.loadbalancers||[];return 0===a.length?React.createElement("div",{className:"alert alert-info"},"This instance is not a member of any load balancer."):React.createElement("div",null,React.createElement("h4",null,"Load balancers containing this instance"),
React.createElement("ul",{className:"list-group"},a.map(b=>React.createElement("li",{key:b.id,className:"list-group-item"},React.createElement("strong",null,React.createElement("a",{href:`/infrastructure/networks/${b.networkId}`,target:"_blank",rel:"noreferrer"},b.name)),React.createElement("div",{className:"text-muted"},"Members:",(b.members||[]).length)))))},App=()=>{var c=document.getElementById("octavia-loadbalancer-view"),a=c?.dataset.model;c=c?.dataset.id;if(!a||!c){var b=window.location.pathname.split("/").filter(Boolean);
const d=b.indexOf("instances"),e=b.indexOf("networks");-1!==d&&b[d+1]?(a="instance",c=b[d+1]):-1!==e&&b[e+1]&&(a="network",c=b[e+1])}b="network"===a?c:null;a="instance"===a?c:null;return b?React.createElement(NetworkView,{networkId:b}):a?React.createElement(InstanceView,{instanceId:a}):React.createElement("div",{className:"alert alert-warning"},"Context missing.")};
ReactDOM.createRoot?ReactDOM.createRoot(mountNode).render(React.createElement(App,null)):ReactDOM.render(React.createElement(App,null),mountNode);