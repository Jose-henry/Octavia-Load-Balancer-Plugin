//# sourceMappingURL=octavia-loadbalancer-ui.js.map
window.Octavia=window.Octavia||{};window.Octavia.Badge=({text:a,tone:d="info"})=>React.createElement("span",{className:`label label-${d}`,style:{marginRight:6,borderRadius:3,padding:"3px 8px",fontSize:"0.8em"}},a);
window.Octavia.Field=({label:a,children:d,help:g,required:k})=>React.createElement("div",{className:"form-group"},React.createElement("label",{className:"control-label"},a,k?React.createElement("span",{className:"text-danger"}," *"):null),d,g?React.createElement("div",{className:"help-block"},g):null);
window.Octavia.Toast=({msg:a,type:d,onClose:g})=>{React.useEffect(()=>{const k=setTimeout(g,3E3);return()=>clearTimeout(k)},[g]);return React.createElement("div",{style:{position:"fixed",top:20,right:20,zIndex:9999,backgroundColor:"error"===d?"#f2dede":"#dff0d8",color:"error"===d?"#a94442":"#3c763d",padding:"10px 20px",borderRadius:4,boxShadow:"0 2px 10px rgba(0,0,0,0.2)",display:"flex",alignItems:"center"}},React.createElement("span",{style:{marginRight:10}},a),React.createElement("button",{onClick:g,
style:{background:"none",border:"none",fontSize:16,cursor:"pointer",color:"inherit"}},"&times;"))};window.Octavia=window.Octavia||{};
(function(){const a=()=>{const c=document.querySelector('meta[name="csrf-token"]')||document.querySelector('meta[name="_csrf"]');return c?c.getAttribute("content"):null},d=()=>{const c=document.querySelector('meta[name="_csrf_header"]');return c?c.getAttribute("content"):"X-CSRF-TOKEN"},g=c=>(c=document.cookie.match(new RegExp("(^|; )"+c.replace(/([.*+?^${}()|[\]\\])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(c[2]):null,k=(c,e={})=>{const q={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};
e.body&&(q["Content-Type"]="application/json");var b=a();if(b){const l=d();q[l]=b;q["X-CSRF-TOKEN"]=b}if(b=g("XSRF-TOKEN"))q["X-XSRF-TOKEN"]=b,q["X-CSRF-TOKEN"]||(q["X-CSRF-TOKEN"]=b);e=Object.assign({credentials:"include",headers:q},e);console.log(`[Octavia] Fetching: ${c}`,e);return fetch(c,e).then(async l=>{var h=await l.text();if(h)try{var u=JSON.parse(h)}catch(v){u={raw:h}}else u={};h=u;if(!l.ok)throw Error(h?.message||h?.error||`Request failed (${l.status})`);return h})};window.Octavia.makeApi=
c=>{const e=`/plugin/${c}`;console.log(`[Octavia API] Initialized with Base URL: ${e}`);const q=(b,l)=>{const h=[];l&&l.networkId&&h.push("networkId="+l.networkId);l&&l.instanceId&&h.push("instanceId="+l.instanceId);return 0===h.length?b:b+(b.includes("?")?"&":"?")+h.join("&")};return{getSubnets:b=>b?k(`${e}/optionSubnets?networkId=${b}`,{method:"GET"}):Promise.resolve({data:[]}),listLoadBalancers:b=>k(q(`${e}/loadbalancers`,b)),getLoadBalancer:(b,l)=>k(q(`${e}/loadbalancerDetails?id=${b}`,l)),createLoadBalancer:b=>
k(`${e}/loadbalancersCreate`,{method:"POST",body:JSON.stringify(b)}),updateLoadBalancer:(b,l)=>k(`${e}/loadbalancerUpdate`,{method:"POST",body:JSON.stringify({...l,id:b})}),deleteLoadBalancer:(b,l)=>k(`${e}/loadbalancersDelete`,{method:"POST",body:JSON.stringify({lbId:b,networkId:l})}),listOptions:(b,l)=>{b={networkId:b,instanceId:l};return Promise.all([k(q(`${e}/optionProjects`,b)).then(h=>({optionProjects:h.data||[]})),k(q(`${e}/optionSubnets`,b)).then(h=>({optionSubnets:h.data||[]})),k(q(`${e}/optionInstances`,
b)).then(h=>({optionInstances:h.data||[]})),k(q(`${e}/optionFloatingIpPools`,b)).then(h=>({optionFloatingIpPools:h.data||[]}))]).then(h=>h.reduce((u,v)=>({...u,...v}),{}))},listListeners:(b,l)=>k(q(`${e}/loadbalancerDetails?id=${b}`,l)).then(h=>({listeners:h.loadbalancer?.listeners||[]})),listPools:(b,l)=>k(q(`${e}/loadbalancerDetails?id=${b}`,l)).then(h=>({pools:h.loadbalancer?.pools||[]})),getHealthMonitor:(b,l)=>k(q(`${e}/loadbalancerDetails?id=${b}`,l)).then(h=>{h=(h.loadbalancer?.pools||[]).find(u=>
u.healthmonitor_id)?.healthmonitor_id;return{monitor:h?{id:h}:null}}),attachFloatingIp:(b,l,h)=>k(`${e}/floatingipAttach`,{method:"POST",body:JSON.stringify({lbId:b,floatingIpPoolId:l,networkId:h})}),detachFloatingIp:(b,l)=>k(`${e}/floatingipDetach`,{method:"POST",body:JSON.stringify({lbId:b,networkId:l})}),pollStatus:(b,l,h=3E3,u=40)=>new Promise((v,w)=>{let m=0;const y=()=>{m++;k(q(`${e}/loadbalancerDetails?id=${b}`,l)).then(x=>{x=x.data||x.loadbalancer||x;const n=x.provisioning_status;"ACTIVE"===
n||"ERROR"===n||"DELETED"===n?v(x):m>=u?w(Error("Status polling timed out")):setTimeout(y,h)}).catch(x=>{m>=u?w(x):setTimeout(y,h)})};y()})}};window.Octavia.useAsync=(c,e)=>{const [q,b]=React.useState({loading:!0});React.useEffect(()=>{let l=!0;b({loading:!0});c().then(h=>l&&b({loading:!1,data:h})).catch(h=>l&&b({loading:!1,error:h}));return()=>{l=!1}},e);return q}})();
(function(){window.Octavia=window.Octavia||{};window.Octavia.Steps={Step1_Details:({data:a,update:d,options:g})=>{const {Field:k}=window.Octavia;return React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(k,{label:"Name",required:!0},React.createElement("input",{className:"form-control",value:a.name||"",onChange:c=>d("name",c.target.value),placeholder:"My Load Balancer"}))),React.createElement("div",
{className:"col-md-6"},React.createElement(k,{label:"Description"},React.createElement("input",{className:"form-control",value:a.description||"",onChange:c=>d("description",c.target.value),placeholder:"Optional description"})))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(k,{label:"VIP Subnet",required:!0},React.createElement("select",{className:"form-control",value:a.vipSubnetId||"",onChange:c=>d("vipSubnetId",c.target.value)},
React.createElement("option",{value:!0},"Select Subnet..."),(g.subnets||[]).map(c=>React.createElement("option",{key:c.value,value:c.value},c.name,c.cidr?`(${c.cidr})`:""))))),React.createElement("div",{className:"col-md-6"},React.createElement(k,{label:"IP Address"},React.createElement("input",{className:"form-control",value:a.vipAddress||"",onChange:c=>d("vipAddress",c.target.value),placeholder:"Auto-assign"})))))},Step2_Listener:({data:a,update:d})=>{const {Field:g}=window.Octavia,k="HTTP HTTPS TERMINATED_HTTPS TCP UDP SCTP".split(" "),
c=["HTTP","TERMINATED_HTTPS"].includes(a.listenerProtocol),e="TERMINATED_HTTPS"===a.listenerProtocol,q=["UDP","SCTP"].includes(a.listenerProtocol);return React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.createListener,onChange:b=>d("createListener",b.target.checked)}),
React.createElement("strong",null,"Create Listener"))))),a.createListener&&React.createElement("div",{style:{borderLeft:"3px solid #ddd",paddingLeft:15,marginLeft:5}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Listener Name",required:!0},React.createElement("input",{className:"form-control",value:a.listenerName||"",onChange:b=>d("listenerName",b.target.value)}))),React.createElement("div",{className:"col-md-3"},React.createElement(g,
{label:"Protocol",required:!0},React.createElement("select",{className:"form-control",value:a.listenerProtocol||"HTTP",onChange:b=>d("listenerProtocol",b.target.value)},k.map(b=>React.createElement("option",{key:b,value:b},b))))),React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"Port",required:!0},React.createElement("input",{type:"number",className:"form-control",value:a.listenerPort||80,onChange:b=>d("listenerPort",parseInt(b.target.value)),min:"1",max:"65535"})))),
React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Connection Limit"},React.createElement("input",{type:"number",className:"form-control",value:a.connectionLimit||-1,onChange:b=>d("connectionLimit",parseInt(b.target.value)),placeholder:"-1 for infinite"}))),React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Allowed CIDRs"},React.createElement("input",{className:"form-control",value:a.allowedCidrs||
"",onChange:b=>d("allowedCidrs",b.target.value),placeholder:"e.g. 192.168.1.0/24, 10.0.0.0/8"})))),!q&&React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"Client Data Timeout"},React.createElement("input",{type:"number",className:"form-control",value:a.clientDataTimeout||5E4,onChange:b=>d("clientDataTimeout",parseInt(b.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"TCP Inspect Timeout"},
React.createElement("input",{type:"number",className:"form-control",value:a.tcpInspectTimeout||0,onChange:b=>d("tcpInspectTimeout",parseInt(b.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"Member Connect Timeout"},React.createElement("input",{type:"number",className:"form-control",value:a.memberConnectTimeout||5E3,onChange:b=>d("memberConnectTimeout",parseInt(b.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(g,
{label:"Member Data Timeout"},React.createElement("input",{type:"number",className:"form-control",value:a.memberDataTimeout||5E4,onChange:b=>d("memberDataTimeout",parseInt(b.target.value))})))),c&&React.createElement("div",{className:"well ml-3"},React.createElement("label",null,"Insert Headers"),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.insertXForwardedFor||!1,onChange:b=>d("insertXForwardedFor",b.target.checked)}),
" X-Forwarded-For")),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.insertXForwardedPort||!1,onChange:b=>d("insertXForwardedPort",b.target.checked)})," X-Forwarded-Port")),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.insertXForwardedProto||!1,onChange:b=>d("insertXForwardedProto",b.target.checked)})," X-Forwarded-Proto"))),
e&&React.createElement("div",{className:"well ml-3"},React.createElement("label",null,"TLS Configuration"),React.createElement(g,{label:"TLS Cipher String"},React.createElement("input",{className:"form-control",value:a.tlsCipherString||"",onChange:b=>d("tlsCipherString",b.target.value),placeholder:"Default"})))))},Step3_Pool:({data:a,update:d})=>{const {Field:g}=window.Octavia,k=["ROUND_ROBIN","LEAST_CONNECTIONS","SOURCE_IP"],c=["HTTP","HTTPS","TCP","UDP","SCTP"];return React.createElement("div",
{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.createPool,onChange:e=>d("createPool",e.target.checked)}),React.createElement("strong",null,"Create Pool"))))),a.createPool&&React.createElement("div",{style:{borderLeft:"3px solid #ddd",paddingLeft:15,marginLeft:5}},React.createElement("div",
{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Pool Name",required:!0},React.createElement("input",{className:"form-control",value:a.poolName||"",onChange:e=>d("poolName",e.target.value)}))),React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Algorithm",required:!0},React.createElement("select",{className:"form-control",value:a.poolAlgorithm||"ROUND_ROBIN",onChange:e=>d("poolAlgorithm",e.target.value)},k.map(e=>React.createElement("option",
{key:e,value:e},e)))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Protocol",required:!0},React.createElement("select",{className:"form-control",value:a.poolProtocol||a.listenerProtocol||"HTTP",onChange:e=>d("poolProtocol",e.target.value)},c.map(e=>React.createElement("option",{key:e,value:e},e))))),React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Description"},React.createElement("input",
{className:"form-control",value:a.poolDesc||"",onChange:e=>d("poolDesc",e.target.value)})))),React.createElement("div",{className:"well"},React.createElement("label",null,"Session Persistence"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Type"},React.createElement("select",{className:"form-control",value:a.sessionPersistence||"None",onChange:e=>d("sessionPersistence",e.target.value)},React.createElement("option",{value:"None"},
"None"),React.createElement("option",{value:"SOURCE_IP"},"Source IP"),React.createElement("option",{value:"HTTP_COOKIE"},"HTTP Cookie"),React.createElement("option",{value:"APP_COOKIE"},"App Cookie")))),"APP_COOKIE"===a.sessionPersistence&&React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Cookie Name",required:!0},React.createElement("input",{className:"form-control",value:a.cookieName||"",onChange:e=>d("cookieName",e.target.value)}))))),React.createElement("div",{className:"well"},
React.createElement("label",null,"TLS Encryption (Backend Re-encryption)"),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.poolTlsEnabled||!1,onChange:e=>d("poolTlsEnabled",e.target.checked)}),"Enable TLS")),a.poolTlsEnabled&&React.createElement(g,{label:"Cipher String"},React.createElement("input",{className:"form-control",value:a.poolTlsCipher||"",onChange:e=>d("poolTlsCipher",e.target.value),placeholder:"Default"})))))},
Step4_Members:({data:a,update:d,options:g})=>{const {Badge:k}=window.Octavia,[c,e]=React.useState(""),q=(g.instances||[]).filter(n=>!(a.members||[]).find(z=>z.id===n.value)),[b,l]=React.useState(""),[h,u]=React.useState(80),[v,w]=React.useState(1),m=()=>{if(c){var n=g.instances.find(z=>z.value===c);n={id:n.value,name:n.name,type:"INTERNAL",address:"10.0.0."+Math.floor(255*Math.random()),port:80,weight:1,role:"member"};d("members",[...(a.members||[]),n]);e("")}},y=()=>{if(b){var n={id:"ext-"+Math.floor(1E4*
Math.random()),name:b,type:"EXTERNAL",address:b,port:h,weight:v,role:"member"};d("members",[...(a.members||[]),n]);l("")}},x=n=>{d("members",(a.members||[]).filter(z=>z.id!==n))};return React.createElement("div",null,a.createPool?React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},"Add Instance Member"),React.createElement("div",
{className:"panel-body"},React.createElement("div",{className:"input-group"},React.createElement("select",{className:"form-control",value:c,onChange:n=>e(n.target.value)},React.createElement("option",{value:!0},"Select Instance..."),q.map(n=>React.createElement("option",{key:n.value,value:n.value},n.name))),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-success",onClick:m,disabled:!c},"Add")))))),React.createElement("div",{className:"col-md-6"},
React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},"Add External Member"),React.createElement("div",{className:"panel-body"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-5"},React.createElement("input",{className:"form-control input-sm",placeholder:"IP Address",value:b,onChange:n=>l(n.target.value)})),React.createElement("div",{className:"col-xs-3"},React.createElement("input",{type:"number",
className:"form-control input-sm",placeholder:"Port",value:h,onChange:n=>u(parseInt(n.target.value))})),React.createElement("div",{className:"col-xs-2"},React.createElement("input",{type:"number",className:"form-control input-sm",placeholder:"Wgt",value:v,onChange:n=>w(parseInt(n.target.value))})),React.createElement("div",{className:"col-xs-2"},React.createElement("button",{className:"btn btn-success btn-sm btn-block",onClick:y,disabled:!b},"Add"))))))),React.createElement("table",{className:"table table-striped table-bordered"},
React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"Address"),React.createElement("th",null,"Port"),React.createElement("th",null,"Weight"),React.createElement("th",null,"Type"),React.createElement("th",null))),React.createElement("tbody",null,0===(a.members||[]).length?React.createElement("tr",null,React.createElement("td",{colSpan:"6",className:"text-center text-muted"},"No members defined")):(a.members||[]).map(n=>
React.createElement("tr",{key:n.id},React.createElement("td",null,n.name),React.createElement("td",null,n.address),React.createElement("td",null,n.port),React.createElement("td",null,n.weight),React.createElement("td",null,React.createElement(k,{text:n.type||"INTERNAL",tone:"EXTERNAL"===n.type?"warning":"info"})),React.createElement("td",{className:"text-right"},React.createElement("button",{className:"btn btn-xs",style:{backgroundColor:"#b00020",color:"#fff",border:"none",padding:"3px 8px"},onClick:()=>
x(n.id)},React.createElement("i",{className:"fa fa-trash"})))))))):React.createElement("div",{className:"alert alert-warning"},"Pool creation is disabled. No members can be added."))},Step5_Monitor:({data:a,update:d})=>{const {Field:g}=window.Octavia,k="HTTP HTTPS PING TCP TLS-HELLO UDP-CONNECT SCTP".split(" ");return React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12"},React.createElement("div",
{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.createMonitor,onChange:c=>d("createMonitor",c.target.checked)}),React.createElement("strong",null,"Create Health Monitor"))))),a.createMonitor&&React.createElement("div",{style:{borderLeft:"3px solid #ddd",paddingLeft:15,marginLeft:5}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Name",required:!0},React.createElement("input",
{className:"form-control",value:a.monitorName||"",onChange:c=>d("monitorName",c.target.value)}))),React.createElement("div",{className:"col-md-6"},React.createElement(g,{label:"Type",required:!0},React.createElement("select",{className:"form-control",value:a.monitorType||"HTTP",onChange:c=>d("monitorType",c.target.value)},k.map(c=>React.createElement("option",{key:c,value:c},c)))))),("HTTP"===a.monitorType||"HTTPS"===a.monitorType)&&React.createElement("div",null,React.createElement("div",{className:"row"},
React.createElement("div",{className:"col-md-4"},React.createElement(g,{label:"HTTP Method"},React.createElement("select",{className:"form-control",value:a.httpMethod||"GET",onChange:c=>d("httpMethod",c.target.value)},"GET HEAD POST PUT DELETE TRACE OPTIONS PATCH CONNECT".split(" ").map(c=>React.createElement("option",{key:c,value:c},c))))),React.createElement("div",{className:"col-md-4"},React.createElement(g,{label:"Expected Codes"},React.createElement("input",{className:"form-control",value:a.expectedCodes||
"200",onChange:c=>d("expectedCodes",c.target.value),placeholder:"200, 200-204"}))),React.createElement("div",{className:"col-md-4"},React.createElement(g,{label:"URL Path"},React.createElement("input",{className:"form-control",value:a.urlPath||"/",onChange:c=>d("urlPath",c.target.value),placeholder:"/"}))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"Delay (sec)",required:!0},React.createElement("input",{type:"number",
className:"form-control",value:a.delay||5,onChange:c=>d("delay",parseInt(c.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"Timeout (sec)",required:!0},React.createElement("input",{type:"number",className:"form-control",value:a.timeout||5,onChange:c=>d("timeout",parseInt(c.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"Max Retries",required:!0},React.createElement("input",{type:"number",className:"form-control",
value:a.maxRetries||3,onChange:c=>d("maxRetries",parseInt(c.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(g,{label:"Max Retries Down"},React.createElement("input",{type:"number",className:"form-control",value:a.maxRetriesDown||3,onChange:c=>d("maxRetriesDown",parseInt(c.target.value))}))))))}}})();
const DeleteConfirmModal=({lb:a,onClose:d,onConfirm:g,loading:k})=>React.createElement("div",{className:"modal fade in",style:{display:"block"}},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close",onClick:d,"data-dismiss":"modal","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},React.createElement("svg",{version:"1.1",
className:"close-icon",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 59.9 59.9",enableBackground:"new 0 0 59.9 59.9",xmlSpace:"preserve"},React.createElement("line",{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",x1:"57.4",y1:"2.5",x2:"2.5",y2:"57.4"}),React.createElement("line",{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",x1:"2.5",y1:"2.5",x2:"57.4",y2:"57.4"})))),React.createElement("h4",{className:"modal-title"},"Delete Load Balancer")),
React.createElement("div",{className:"modal-body"},React.createElement("p",null,"Are you sure you want to delete",React.createElement("strong",null,a.name),"?"),React.createElement("p",{className:"text-muted"},React.createElement("small",null,"This action cannot be undone.")),k&&React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fa fa-spinner fa-spin"})," Deleting...")),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-link",
onClick:d,disabled:k},"Cancel"),React.createElement("button",{className:"btn btn-danger",onClick:g,disabled:k},"Delete")))),React.createElement("div",{className:"modal-backdrop fade in"}));window.Octavia=window.Octavia||{};window.Octavia.DeleteConfirmModal=DeleteConfirmModal;
(function(){window.Octavia.CreateWizard=({networkId:a,options:d,onCreated:g,onClose:k})=>{const {Step1_Details:c,Step2_Listener:e,Step3_Pool:q,Step4_Members:b,Step5_Monitor:l}=window.Octavia.Steps,[h,u]=React.useState(1),[v,w]=React.useState(""),[m,y]=React.useState({networkId:a,createListener:!0,createPool:!0,createMonitor:!0,listenerProtocol:"HTTP",listenerPort:80,poolProtocol:"HTTP",poolAlgorithm:"ROUND_ROBIN",monitorType:"HTTP",members:[]}),[x,n]=React.useState(!1),z=(t,B)=>y(E=>({...E,[t]:B}));
React.useEffect(()=>{d&&d.subnets&&0<d.subnets.length&&!m.vipSubnetId&&z("vipSubnetId",d.subnets[0].value)},[d]);const A=t=>{if(1===t){if(!m.name||!m.name.trim())return"Name is required.";if(!m.vipSubnetId)return"VIP Subnet is required."}if(2===t&&m.createListener){if(!m.listenerName||!m.listenerName.trim())return"Listener Name is required.";if(!m.listenerProtocol)return"Listener Protocol is required.";if(!m.listenerPort)return"Listener Port is required."}if(3===t&&m.createPool){if(!m.poolName||!m.poolName.trim())return"Pool Name is required.";
if(!("APP_COOKIE"!==m.sessionPersistence||m.cookieName&&m.cookieName.trim()))return"Cookie Name is required."}if(5===t&&m.createMonitor){if(!m.monitorName||!m.monitorName.trim())return"Monitor Name is required.";if(!m.monitorType)return"Monitor Type is required.";if(!m.delay)return"Delay is required.";if(!m.timeout)return"Timeout is required.";if(!m.maxRetries)return"Max Retries is required."}return null};a=()=>{const t=A(h);t?w(t):(w(""),u(h+1))};const C=()=>{w("");u(h-1)},p=t=>{if(t>h){const B=
A(h);if(B){w(B);return}}w("");u(t)},r=()=>{const t=A(5);t?w(t):(w(""),n(!0),window.Octavia.api.createLoadBalancer(m).then(()=>{n(!1);g()}).catch(B=>{n(!1);w("Error: "+B.message)}))};return React.createElement("div",{className:"modal fade in",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",overflowY:"auto"}},React.createElement("div",{className:"modal-dialog modal-lg"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",
{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:k},React.createElement("span",{"aria-hidden":"true"},React.createElement("svg",{version:"1.1",className:"close-icon",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 59.9 59.9",enableBackground:"new 0 0 59.9 59.9",xmlSpace:"preserve"},React.createElement("line",{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",x1:"57.4",y1:"2.5",x2:"2.5",y2:"57.4"}),
React.createElement("line",{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",x1:"2.5",y1:"2.5",x2:"57.4",y2:"57.4"})))),React.createElement("h4",{className:"modal-title"},"Create Load Balancer")),React.createElement("div",{className:"modal-body"},v&&React.createElement("div",{className:"alert alert-danger",style:{padding:"10px 15px",marginBottom:20}},v),React.createElement("div",{className:"wizard",style:{marginBottom:20}},React.createElement("ul",{className:"breadcrumbs"},React.createElement("li",
{className:1===h?"bc active":"bc",onClick:()=>p(1),style:{cursor:"pointer"}},"Details"),React.createElement("li",{className:2===h?"bc active":"bc",onClick:()=>p(2),style:{cursor:"pointer"}},"Listener"),React.createElement("li",{className:3===h?"bc active":"bc",onClick:()=>p(3),style:{cursor:"pointer"}},"Pool"),React.createElement("li",{className:4===h?"bc active":"bc",onClick:()=>p(4),style:{cursor:"pointer"}},"Members"),React.createElement("li",{className:5===h?"bc active":"bc",onClick:()=>p(5),
style:{cursor:"pointer"}},"Monitor"))),(()=>{switch(h){case 1:return React.createElement(c,{data:m,update:z,options:d});case 2:return React.createElement(e,{data:m,update:z});case 3:return React.createElement(q,{data:m,update:z});case 4:return React.createElement(b,{data:m,update:z,options:d});case 5:return React.createElement(l,{data:m,update:z});default:return React.createElement("div",null,"Unknown Step")}})()),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-default",
onClick:k},"Cancel"),1<h&&React.createElement("button",{className:"btn btn-default",onClick:C},"Previous"),5>h&&React.createElement("button",{className:"btn btn-primary",onClick:a},"Next"),5===h&&React.createElement("button",{className:"btn btn-success",onClick:r,disabled:x},x?"Creating...":"Create Load Balancer")))))}})();
(function(){window.Octavia.EditLBModal=({lb:a,networkId:d,onClose:g,onUpdated:k})=>{const c=window.Octavia.api,{Field:e,useAsync:q}=window.Octavia,{Step2_Listener:b,Step3_Pool:l,Step4_Members:h,Step5_Monitor:u}=window.Octavia.Steps,[v,w]=React.useState("general"),[m,y]=React.useState({...a}),[x,n]=React.useState(!1),{loading:z,data:A}=q(async()=>{const [p,r,t]=await Promise.all([c.listListeners(a.id,{networkId:d}),c.listPools(a.id,{networkId:d}),c.getHealthMonitor(a.id,{networkId:d})]);return{...p,
...r,...t}},[a.id]);React.useEffect(()=>{if(A){const r={...m};if(A.listeners&&0<A.listeners.length){var p=A.listeners[0];r.createListener=!0;r.listenerName=p.name;r.listenerProtocol=p.protocol;r.listenerPort=p.protocol_port;r.connectionLimit=p.connection_limit;r.allowedCidrs=(p.allowed_cidrs||[]).join(",")}else r.createListener=!1;A.pools&&0<A.pools.length?(p=A.pools[0],r.createPool=!0,r.poolName=p.name,r.poolAlgorithm=p.lb_algorithm,r.poolProtocol=p.protocol,r.poolDesc=p.description,r.members=p.members||
[]):r.createPool=!1;A.monitor?(p=A.monitor,r.createMonitor=!0,r.monitorName=p.name||"Monitor",r.monitorType=p.type,r.delay=p.delay,r.timeout=p.timeout,r.maxRetries=p.max_retries):r.createMonitor=!1;y(r)}},[A]);const C=(p,r)=>y(t=>({...t,[p]:r}));return React.createElement("div",{className:"modal fade in",style:{display:"block",overflow:"auto"}},React.createElement("div",{className:"modal-dialog modal-lg"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},
React.createElement("button",{type:"button",className:"close",onClick:g,"data-dismiss":"modal","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},React.createElement("svg",{version:"1.1",className:"close-icon",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 59.9 59.9",enableBackground:"new 0 0 59.9 59.9",xmlSpace:"preserve"},React.createElement("line",{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",x1:"57.4",y1:"2.5",
x2:"2.5",y2:"57.4"}),React.createElement("line",{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",x1:"2.5",y1:"2.5",x2:"57.4",y2:"57.4"})))),React.createElement("h4",{className:"modal-title"},"Edit Load Balancer")),React.createElement("div",{className:"modal-body",style:{padding:0}},React.createElement("div",{className:"tab-container"},React.createElement("ul",{className:"nav nav-tabs",style:{paddingLeft:20,paddingTop:10}},[{key:"general",title:"General"},{key:"listener",title:"Listener"},
{key:"pool",title:"Pool"},{key:"monitor",title:"Health Monitor"}].map((p,r)=>React.createElement("li",{key:p.key,className:v===p.key?"active":""},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault();w(p.key)}},p.title)))),React.createElement("div",{className:"tab-content",style:{padding:20}},z?React.createElement("div",{style:{textAlign:"center",padding:40}},React.createElement("i",{className:"fa fa-spinner fa-spin"})," Loading..."):React.createElement("div",null,"general"===v&&React.createElement("div",
{className:"form-horizontal"},React.createElement(e,{label:"Name"},React.createElement("input",{className:"form-control",value:m.name||"",onChange:p=>C("name",p.target.value)})),React.createElement(e,{label:"Description"},React.createElement("input",{className:"form-control",value:m.description||"",onChange:p=>C("description",p.target.value)})),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12"},React.createElement("div",{className:"checkbox"},React.createElement("label",
null,React.createElement("input",{type:"checkbox",checked:m.admin_state_up,onChange:p=>C("admin_state_up",p.target.checked)})," Admin State Up"))))),"listener"===v&&React.createElement(b,{data:m,update:C}),"pool"===v&&React.createElement("div",null,React.createElement(l,{data:m,update:C}),React.createElement("hr",null),React.createElement("h5",{style:{fontWeight:600,marginBottom:15}},"Members"),React.createElement(h,{data:m,update:C,options:{instances:[]}})),"monitor"===v&&React.createElement(u,{data:m,
update:C}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-link",onClick:g},"Cancel"),React.createElement("button",{className:"btn btn-primary",onClick:()=>{n(!0);c.updateLoadBalancer(a.id,m).then(k).catch(p=>{n(!1);alert(p.message)})},disabled:x||z},x?"Saving...":"Save Changes")))),React.createElement("div",{className:"modal-backdrop fade in"}))}})();
(function(){window.Octavia.NetworkView=({networkId:a})=>{const d=window.Octavia.api,{Badge:g,useAsync:k,Toast:c}=window.Octavia,[e,q]=React.useState("list"),[b,l]=React.useState("lbs"),[h,u]=React.useState(null),[v,w]=React.useState(null);var m=k(()=>d.listOptions(a),[a]),y=k(()=>d.listLoadBalancers({networkId:a}),[a,v]);const [x,n]=React.useState(null),[z,A]=React.useState(!1),[C,p]=React.useState([]),r="create"===e;React.useEffect(()=>{r&&d.getSubnets(a).then(f=>{f=(f?.data||[]).map(D=>({name:D.name,
value:D.value,cidr:D.cidr}));p(f)}).catch(f=>console.error("Error fetching subnets:",f))},[r,a]);if(y.error)return React.createElement("div",{className:"alert alert-danger"},y.error.message);if(y.loading||m.loading)return React.createElement("div",{style:{padding:20}},React.createElement("i",{className:"fa fa-spinner fa-spin"})," Loading...");y=y.data.loadbalancers||[];m=m.data||{};const t=y.flatMap(f=>(f.listeners||[]).map(D=>({...D,lbName:f.name}))),B=y.flatMap(f=>(f.pools||[]).map(D=>({...D,lbName:f.name})));
let E=[];B.forEach(f=>{f.members&&f.members.forEach(D=>E.push({...D,poolName:f.name,lbName:f.lbName}))});const F=[];B.forEach(f=>{f.healthmonitor_id&&F.push({id:f.healthmonitor_id,poolName:f.name,lbName:f.lbName})});const G=()=>{A(!0);d.deleteLoadBalancer(x.id,a).then(()=>{A(!1);n(null);w({msg:"Load Balancer deleted successfully.",type:"success"})})},H=window.Octavia.CreateWizard,I=window.Octavia.EditLBModal,J=window.Octavia.DeleteConfirmModal;return React.createElement("div",{style:{padding:"0"}},
v&&React.createElement(c,{msg:v.msg,type:v.type,onClose:()=>w(null)}),x&&React.createElement(J,{lb:x,loading:z,onClose:()=>n(null),onConfirm:G}),"create"===e&&React.createElement(H,{networkId:a,options:{...m,subnets:C},onClose:()=>q("list"),onCreated:()=>{q("list");w({msg:"Load Balancer created.",type:"success"})}}),"edit"===e&&h&&React.createElement(I,{lb:h,networkId:a,onClose:()=>{u(null);q("list")},onUpdated:()=>{u(null);q("list");w({msg:"Load Balancer updated.",type:"success"})}}),"list"===e&&
React.createElement("ul",{className:"nav nav-tabs",style:{marginBottom:"15px"}},React.createElement("li",{className:"lbs"===b?"active":""},React.createElement("a",{href:"#",onClick:f=>{f.preventDefault();l("lbs")}},"Load Balancers")),React.createElement("li",{className:"listeners"===b?"active":""},React.createElement("a",{href:"#",onClick:f=>{f.preventDefault();l("listeners")}},"Listeners")),React.createElement("li",{className:"pools"===b?"active":""},React.createElement("a",{href:"#",onClick:f=>
{f.preventDefault();l("pools")}},"Pools")),React.createElement("li",{className:"members"===b?"active":""},React.createElement("a",{href:"#",onClick:f=>{f.preventDefault();l("members")}},"Members")),React.createElement("li",{className:"monitors"===b?"active":""},React.createElement("a",{href:"#",onClick:f=>{f.preventDefault();l("monitors")}},"Monitors"))),"list"===e&&React.createElement("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:15,padding:"0 5px"}},React.createElement("button",
{className:"btn btn-primary",onClick:()=>q("create")},"+ ADD")),"list"===e&&"lbs"===b&&React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"VIP"),React.createElement("th",null,"Status"),React.createElement("th",null,"Members"),React.createElement("th",null))),React.createElement("tbody",null,y.map(f=>React.createElement("tr",{key:f.id},React.createElement("td",
null,f.name),React.createElement("td",null,f.vip_address),React.createElement("td",null,React.createElement(g,{text:f.provisioning_status,tone:"ACTIVE"===f.provisioning_status?"success":"warning"})),React.createElement("td",null,(f.members||[]).length),React.createElement("td",{style:{textAlign:"right",whiteSpace:"nowrap"}},React.createElement("button",{className:"btn btn-link btn-sm",title:"Edit",onClick:()=>{u(f);q("edit")}},React.createElement("i",{className:"fa fa-pencil",style:{fontSize:"1.2em"}})),
React.createElement("button",{className:"btn btn-link btn-sm",title:"Delete",onClick:()=>n(f)},React.createElement("i",{className:"fa fa-trash",style:{fontSize:"1.2em"}}))))),0===y.length&&React.createElement("tr",null,React.createElement("td",{colSpan:"5",style:{textAlign:"center",padding:40,color:"#999"}},'No Load Balancers found. Click "ADD" to create one.')))),"list"===e&&"listeners"===b&&React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,
React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"Protocol"),React.createElement("th",null,"Port"),React.createElement("th",null,"Default Pool"),React.createElement("th",null,"Status"),React.createElement("th",null))),React.createElement("tbody",null,t.map(f=>React.createElement("tr",{key:f.id},React.createElement("td",null,f.name||f.id),React.createElement("td",null,f.protocol),React.createElement("td",null,f.protocol_port),React.createElement("td",
null,f.default_pool_id?"Yes":"No"),React.createElement("td",null,React.createElement(g,{text:f.provisioning_status,tone:"ACTIVE"===f.provisioning_status?"success":"warning"})),React.createElement("td",null,React.createElement("span",{className:"text-muted text-sm px-2"},"(",f.lbName,")")))),0===t.length&&React.createElement("tr",null,React.createElement("td",{colSpan:"6",style:{textAlign:"center",padding:40,color:"#999"}},"No Listeners found attached to these Load Balancers.")))),"list"===e&&"pools"===
b&&React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"Protocol"),React.createElement("th",null,"Algorithm"),React.createElement("th",null,"Members"),React.createElement("th",null,"Status"),React.createElement("th",null))),React.createElement("tbody",null,B.map(f=>React.createElement("tr",{key:f.id},React.createElement("td",null,f.name||f.id),React.createElement("td",
null,f.protocol),React.createElement("td",null,f.lb_algorithm),React.createElement("td",null,(f.members||[]).length),React.createElement("td",null,React.createElement(g,{text:f.provisioning_status,tone:"ACTIVE"===f.provisioning_status?"success":"warning"})),React.createElement("td",null,React.createElement("span",{className:"text-muted text-sm px-2"},"(",f.lbName,")")))),0===B.length&&React.createElement("tr",null,React.createElement("td",{colSpan:"6",style:{textAlign:"center",padding:40,color:"#999"}},
"No Pools found attached to these Load Balancers.")))),"list"===e&&"members"===b&&React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"Address / Port"),React.createElement("th",null,"Weight"),React.createElement("th",null,"Pool"),React.createElement("th",null,"Status"),React.createElement("th",null))),React.createElement("tbody",null,E.map(f=>React.createElement("tr",
{key:f.id},React.createElement("td",null,f.name||f.id),React.createElement("td",null,f.address,":",f.protocol_port),React.createElement("td",null,f.weight),React.createElement("td",null,f.poolName),React.createElement("td",null,React.createElement(g,{text:f.provisioning_status,tone:"ACTIVE"===f.provisioning_status?"success":"warning"})),React.createElement("td",null,React.createElement("span",{className:"text-muted text-sm px-2"},"(",f.lbName,")")))),0===E.length&&React.createElement("tr",null,React.createElement("td",
{colSpan:"6",style:{textAlign:"center",padding:40,color:"#999"}},"No Members found in any Pools.")))),"list"===e&&"monitors"===b&&React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"Type"),React.createElement("th",null,"Delay/Timeout"),React.createElement("th",null,"Pool"),React.createElement("th",null,"Status"),React.createElement("th",null))),
React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{colSpan:"6",style:{textAlign:"center",padding:40,color:"#999"}},"Monitors are connected to Pools.")))))}})();
(function(){window.Octavia.InstanceView=({instanceId:a})=>{const d=window.Octavia.api,{Badge:g,useAsync:k}=window.Octavia;var c=k(()=>d.listLoadBalancers({instanceId:a}),[a]);if(c.error)return React.createElement("div",{className:"alert alert-danger"},c.error.message);if(c.loading)return React.createElement("div",{style:{padding:20,textAlign:"center"}},React.createElement("span",{style:{display:"inline-block",width:16,height:16,border:"2px solid #ccc",borderTopColor:"#333",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),
" Loading...");c=c.data?.loadbalancers||[];return 0===c.length?React.createElement("div",{className:"alert alert-info"},"This instance is not a member of any Load Balancers."):React.createElement("div",{className:"container-fluid",style:{padding:"0 12px"}},React.createElement("h4",{style:{textTransform:"uppercase",fontWeight:600,letterSpacing:"0.5px",color:"#2d6ca2",marginBottom:15}},"Load balancers associated with this instance"),React.createElement("p",{className:"text-muted",style:{marginBottom:15,
fontSize:"0.9em"}},"This instance is a pool member of the following load balancers. Click a name to manage it on the Network detail page."),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",{style:{textTransform:"uppercase",fontSize:"0.85em",fontWeight:600}},React.createElement("th",null,"Name"),React.createElement("th",null,"VIP"),React.createElement("th",null,
"Status"),React.createElement("th",null,"Members"),React.createElement("th",null,"Network"))),React.createElement("tbody",null,c.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{href:"/infrastructure/networks/"+(e.networkId||"")+"#!octavia-network-tab",style:{fontWeight:"bold",color:"#2d6ca2",textDecoration:"none"},title:"View in Network detail Octavia tab"},e.name)),React.createElement("td",null,e.vip_address),React.createElement("td",null,React.createElement(g,
{text:e.provisioning_status||"ACTIVE",tone:"ACTIVE"===(e.provisioning_status||"ACTIVE")?"success":"warning"})),React.createElement("td",null,(e.members||[]).length),React.createElement("td",null,React.createElement("a",{href:"/infrastructure/networks/"+(e.networkId||""),style:{color:"#2d6ca2"}},e.networkName||"View Network"))))))))}})();window.Octavia=window.Octavia||{};console.log("Octavia UI Components Loaded.");
const mountNode=document.getElementById("octavia-loadbalancer-view"),pluginCode=mountNode?.dataset?.pluginCode||"octavia1234";window.Octavia.api=window.Octavia.makeApi(pluginCode);
const {NetworkView,InstanceView}=window.Octavia,App=()=>{var a=document.getElementById("octavia-loadbalancer-view"),d=a?.dataset.model;a=a?.dataset.id;if(!d||!a){var g=window.location.pathname.split("/").filter(Boolean);const k=g.indexOf("instances"),c=g.indexOf("networks");-1!==k&&g[k+1]?(d="instance",a=g[k+1]):-1!==c&&g[c+1]&&(d="network",a=g[c+1])}g="network"===d?a:null;d="instance"===d?a:null;return g?React.createElement("div",{className:"octavia-plugin"},React.createElement(NetworkView,{networkId:g})):
d?React.createElement("div",{className:"octavia-plugin"},React.createElement(InstanceView,{instanceId:d})):React.createElement("div",{className:"alert alert-warning octavia-plugin"},"Context missing.")};ReactDOM.createRoot?ReactDOM.createRoot(mountNode).render(React.createElement(App,null)):ReactDOM.render(React.createElement(App,null),mountNode);