//# sourceMappingURL=Api.js.map
window.Octavia=window.Octavia||{};
(function(){const r=()=>{const f=document.querySelector('meta[name="csrf-token"]')||document.querySelector('meta[name="_csrf"]');return f?f.getAttribute("content"):null},t=()=>{const f=document.querySelector('meta[name="_csrf_header"]');return f?f.getAttribute("content"):"X-CSRF-TOKEN"},u=f=>(f=document.cookie.match(new RegExp("(^|; )"+f.replace(/([.*+?^${}()|[\]\\])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(f[2]):null,g=(f,d={})=>{const e={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};
d.body&&(e["Content-Type"]="application/json");var a=r();if(a){const b=t();e[b]=a;e["X-CSRF-TOKEN"]=a}if(a=u("XSRF-TOKEN"))e["X-XSRF-TOKEN"]=a,e["X-CSRF-TOKEN"]||(e["X-CSRF-TOKEN"]=a);d=Object.assign({credentials:"include",headers:e},d);console.log(`[Octavia] Fetching: ${f}`,d);return fetch(f,d).then(async b=>{var c=await b.text();if(c)try{var h=JSON.parse(c)}catch(l){h={raw:c}}else h={};c=h;if(!b.ok)throw Error(c?.message||c?.error||`Request failed (${b.status})`);return c})};window.Octavia.makeApi=
f=>{const d=`/plugin/${f}`,e=(a,b)=>{const c=[];b&&b.networkId&&c.push("networkId="+b.networkId);b&&b.instanceId&&c.push("instanceId="+b.instanceId);return 0===c.length?a:a+(a.includes("?")?"&":"?")+c.join("&")};return{listLoadBalancers:a=>g(e(`${d}/loadbalancers`,a)),getLoadBalancer:(a,b)=>g(e(`${d}/loadbalancerDetails?id=${a}`,b)),createLoadBalancer:a=>g(`${d}/loadbalancersCreate`,{method:"POST",body:JSON.stringify(a)}),updateLoadBalancer:(a,b)=>g(`${d}/loadbalancerUpdate`,{method:"POST",body:JSON.stringify({...b,
id:a})}),deleteLoadBalancer:(a,b)=>g(`${d}/loadbalancersDelete`,{method:"POST",body:JSON.stringify({lbId:a,networkId:b})}),listOptions:(a,b)=>{a={networkId:a,instanceId:b};return Promise.all([g(e(`${d}/optionProjects`,a)),g(e(`${d}/optionSubnets`,a)),g(e(`${d}/optionInstances`,a)),g(e(`${d}/optionFloatingIpPools`,a))]).then(c=>c.reduce((h,l)=>({...h,...l}),{}))},listListeners:(a,b)=>g(e(`${d}/loadbalancerDetails?id=${a}`,b)).then(c=>({listeners:c.loadbalancer?.listeners||[]})),listPools:(a,b)=>g(e(`${d}/loadbalancerDetails?id=${a}`,
b)).then(c=>({pools:c.loadbalancer?.pools||[]})),getHealthMonitor:(a,b)=>g(e(`${d}/loadbalancerDetails?id=${a}`,b)).then(c=>{c=(c.loadbalancer?.pools||[]).find(h=>h.healthmonitor_id)?.healthmonitor_id;return{monitor:c?{id:c}:null}}),attachFloatingIp:(a,b,c)=>g(`${d}/floatingipAttach`,{method:"POST",body:JSON.stringify({lbId:a,floatingIpPoolId:b,networkId:c})}),detachFloatingIp:(a,b)=>g(`${d}/floatingipDetach`,{method:"POST",body:JSON.stringify({lbId:a,networkId:b})}),pollStatus:(a,b,c=3E3,h=40)=>
new Promise((l,q)=>{let m=0;const p=()=>{m++;g(e(`${d}/loadbalancerDetails?id=${a}`,b)).then(k=>{k=k.data||k.loadbalancer||k;const n=k.provisioning_status;"ACTIVE"===n||"ERROR"===n||"DELETED"===n?l(k):m>=h?q(Error("Status polling timed out")):setTimeout(p,c)}).catch(k=>{m>=h?q(k):setTimeout(p,c)})};p()})}};window.Octavia.useAsync=(f,d)=>{const [e,a]=React.useState({loading:!0});React.useEffect(()=>{let b=!0;a({loading:!0});f().then(c=>b&&a({loading:!1,data:c})).catch(c=>b&&a({loading:!1,error:c}));
return()=>{b=!1}},d);return e}})();