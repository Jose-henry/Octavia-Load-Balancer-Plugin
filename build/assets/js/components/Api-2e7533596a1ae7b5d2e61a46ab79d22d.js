//# sourceMappingURL=Api.js.map
window.Octavia=window.Octavia||{};
(function(){const r=()=>{const f=document.querySelector('meta[name="csrf-token"]')||document.querySelector('meta[name="_csrf"]');return f?f.getAttribute("content"):null},t=()=>{const f=document.querySelector('meta[name="_csrf_header"]');return f?f.getAttribute("content"):"X-CSRF-TOKEN"},u=f=>(f=document.cookie.match(new RegExp("(^|; )"+f.replace(/([.*+?^${}()|[\]\\])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(f[2]):null,g=(f,d={})=>{const e={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};
d.body&&(e["Content-Type"]="application/json");var a=r();if(a){const c=t();e[c]=a;e["X-CSRF-TOKEN"]=a}if(a=u("XSRF-TOKEN"))e["X-XSRF-TOKEN"]=a,e["X-CSRF-TOKEN"]||(e["X-CSRF-TOKEN"]=a);d=Object.assign({credentials:"include",headers:e},d);console.log(`[Octavia] Fetching: ${f}`,d);return fetch(f,d).then(async c=>{var b=await c.text();if(b)try{var h=JSON.parse(b)}catch(l){h={raw:b}}else h={};b=h;if(!c.ok)throw Error(b?.message||b?.error||`Request failed (${c.status})`);return b})};window.Octavia.makeApi=
f=>{const d=`/plugin/${f}`;console.log(`[Octavia API] Initialized with Base URL: ${d}`);const e=(a,c)=>{const b=[];c&&c.networkId&&b.push("networkId="+c.networkId);c&&c.instanceId&&b.push("instanceId="+c.instanceId);return 0===b.length?a:a+(a.includes("?")?"&":"?")+b.join("&")};return{getSubnets:a=>a?g(`${d}/optionSubnets?networkId=${a}`,{method:"GET"}):Promise.resolve({data:[]}),listLoadBalancers:a=>g(e(`${d}/loadbalancers`,a)),getLoadBalancer:(a,c)=>g(e(`${d}/loadbalancerDetails?id=${a}`,c)),createLoadBalancer:a=>
g(`${d}/loadbalancersCreate`,{method:"POST",body:JSON.stringify(a)}),updateLoadBalancer:(a,c)=>g(`${d}/loadbalancerUpdate`,{method:"POST",body:JSON.stringify({...c,id:a})}),deleteLoadBalancer:(a,c)=>g(`${d}/loadbalancersDelete`,{method:"POST",body:JSON.stringify({lbId:a,networkId:c})}),listOptions:(a,c)=>{a={networkId:a,instanceId:c};return Promise.all([g(e(`${d}/optionProjects`,a)).then(b=>({optionProjects:b.data||[],optionResourcePools:b.resourcePools||[]})),g(e(`${d}/optionSubnets`,a)).then(b=>
({optionSubnets:b.data||[]})),g(e(`${d}/optionInstances`,a)).then(b=>({optionInstances:b.data||[]})),g(e(`${d}/optionFloatingIpPools`,a)).then(b=>({optionFloatingIpPools:b.data||[]}))]).then(b=>b.reduce((h,l)=>({...h,...l}),{}))},listListeners:(a,c)=>g(e(`${d}/loadbalancerDetails?id=${a}`,c)).then(b=>({listeners:b.loadbalancer?.listeners||[]})),listPools:(a,c)=>g(e(`${d}/loadbalancerDetails?id=${a}`,c)).then(b=>({pools:b.loadbalancer?.pools||[]})),getHealthMonitor:(a,c)=>g(e(`${d}/loadbalancerDetails?id=${a}`,
c)).then(b=>{b=(b.loadbalancer?.pools||[]).find(h=>h.healthmonitor_id)?.healthmonitor_id;return{monitor:b?{id:b}:null}}),attachFloatingIp:(a,c,b)=>g(`${d}/floatingipAttach`,{method:"POST",body:JSON.stringify({lbId:a,floatingIpPoolId:c,networkId:b})}),detachFloatingIp:(a,c)=>g(`${d}/floatingipDetach`,{method:"POST",body:JSON.stringify({lbId:a,networkId:c})}),pollStatus:(a,c,b=3E3,h=40)=>new Promise((l,q)=>{let m=0;const p=()=>{m++;g(e(`${d}/loadbalancerDetails?id=${a}`,c)).then(k=>{k=k.data||k.loadbalancer||
k;const n=k.provisioning_status;"ACTIVE"===n||"ERROR"===n||"DELETED"===n?l(k):m>=h?q(Error("Status polling timed out")):setTimeout(p,b)}).catch(k=>{m>=h?q(k):setTimeout(p,b)})};p()})}};window.Octavia.useAsync=(f,d)=>{const [e,a]=React.useState({loading:!0});React.useEffect(()=>{let c=!0;a({loading:!0});f().then(b=>c&&a({loading:!1,data:b})).catch(b=>c&&a({loading:!1,error:b}));return()=>{c=!1}},d);return e}})();