//# sourceMappingURL=octavia-loadbalancer-ui.js.map
console.log("Octavia UI Script Executing...");
const csrfToken=()=>{const a=document.querySelector('meta[name="csrf-token"]')||document.querySelector('meta[name="_csrf"]');return a?a.getAttribute("content"):null},csrfHeaderName=()=>{const a=document.querySelector('meta[name="_csrf_header"]');return a?a.getAttribute("content"):"X-CSRF-TOKEN"},cookieVal=a=>(a=document.cookie.match(new RegExp("(^|; )"+a.replace(/([.*+?^${}()|[\]\\])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(a[2]):null,apiFetch=(a,c={})=>{const e={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};
c.body&&(e["Content-Type"]="application/json");var b=csrfToken();if(b){const d=csrfHeaderName();e[d]=b;e["X-CSRF-TOKEN"]=b}if(b=cookieVal("XSRF-TOKEN"))e["X-XSRF-TOKEN"]=b,e["X-CSRF-TOKEN"]||(e["X-CSRF-TOKEN"]=b);c=Object.assign({credentials:"include",headers:e},c);return fetch(a,c).then(async d=>{var g=await d.text();if(g)try{var f=JSON.parse(g)}catch(q){f={raw:g}}else f={};g=f;if(!d.ok)throw Error(g?.message||g?.error||`Request failed (${d.status})`);return g})},useAsync=(a,c)=>{const [e,b]=React.useState({loading:!0});
React.useEffect(()=>{let d=!0;b({loading:!0});a().then(g=>d&&b({loading:!1,data:g})).catch(g=>d&&b({loading:!1,error:g}));return()=>{d=!1}},c);return e},Badge=({text:a,tone:c="info"})=>React.createElement("span",{className:`label label-${c}`,style:{marginRight:6,borderRadius:3,padding:"3px 8px",fontSize:"0.8em"}},a),Field=({label:a,children:c,help:e,required:b})=>React.createElement("div",{className:"form-group"},React.createElement("label",{className:"control-label"},a,b?React.createElement("span",
{className:"text-danger"}," *"):null),c,e?React.createElement("div",{className:"help-block"},e):null),makeApi=a=>{const c=`/plugin/${a}`,e=(b,d)=>{const g=[];d&&d.networkId&&g.push("networkId="+d.networkId);d&&d.instanceId&&g.push("instanceId="+d.instanceId);return 0===g.length?b:b+(b.includes("?")?"&":"?")+g.join("&")};return{listLoadBalancers:b=>apiFetch(e(`${c}/loadbalancers`,b)),getLoadBalancer:(b,d)=>apiFetch(e(`${c}/loadbalancers/details?id=${b}`,d)),createLoadBalancer:b=>apiFetch(`${c}/loadbalancers/create`,
{method:"POST",body:JSON.stringify(b)}),updateLoadBalancer:(b,d)=>apiFetch(`${c}/loadbalancers/update`,{method:"POST",body:JSON.stringify({...d,id:b})}),deleteLoadBalancer:(b,d)=>apiFetch(`${c}/loadbalancers/delete`,{method:"POST",body:JSON.stringify({lbId:b,networkId:d})}),listOptions:(b,d)=>{const g={networkId:b,instanceId:d};return Promise.all(["projects","subnets","instances","floatingIpPools"].map(f=>apiFetch(e(`${c}/options/${f}`,g)))).then(f=>f.reduce((q,l)=>({...q,...l}),{}))},listListeners:(b,
d)=>apiFetch(e(`${c}/loadbalancers/details?id=${b}`,d)).then(g=>({listeners:g.loadbalancer?.listeners||[]})),listPools:(b,d)=>apiFetch(e(`${c}/loadbalancers/details?id=${b}`,d)).then(g=>({pools:g.loadbalancer?.pools||[]})),getHealthMonitor:(b,d)=>apiFetch(e(`${c}/loadbalancers/details?id=${b}`,d)).then(g=>{g=(g.loadbalancer?.pools||[]).find(f=>f.healthmonitor_id)?.healthmonitor_id;return{monitor:g?{id:g}:null}}),attachFloatingIp:(b,d,g)=>apiFetch(`${c}/floatingip/attach`,{method:"POST",body:JSON.stringify({lbId:b,
floatingIpPoolId,networkId:g})}),detachFloatingIp:(b,d)=>apiFetch(`${c}/floatingip/detach`,{method:"POST",body:JSON.stringify({lbId:b,networkId:d})})}},mountNode=document.getElementById("octavia-loadbalancer-view"),pluginCode=mountNode?.dataset?.pluginCode||"octavia1234",Api=makeApi(pluginCode),Toast=({msg:a,type:c,onClose:e})=>{React.useEffect(()=>{const b=setTimeout(e,3E3);return()=>clearTimeout(b)},[e]);return React.createElement("div",{style:{position:"fixed",top:20,right:20,zIndex:9999,backgroundColor:"error"===
c?"#f2dede":"#dff0d8",color:"error"===c?"#a94442":"#3c763d",padding:"10px 20px",borderRadius:4,boxShadow:"0 2px 10px rgba(0,0,0,0.2)",display:"flex",alignItems:"center"}},React.createElement("span",{style:{marginRight:10}},a),React.createElement("button",{onClick:e,style:{background:"none",border:"none",fontSize:16,cursor:"pointer",color:"inherit"}},"&times;"))},DeleteConfirmModal=({lb:a,onClose:c,onConfirm:e,loading:b})=>React.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,
background:"rgba(0,0,0,0.5)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"}},React.createElement("div",{className:"panel panel-danger",style:{width:420,boxShadow:"0 5px 15px rgba(0,0,0,0.3)",borderRadius:0}},React.createElement("div",{className:"panel-heading",style:{background:"#d9534f",color:"#fff",borderRadius:0}},React.createElement("h3",{className:"panel-title",style:{textTransform:"uppercase",fontWeight:600,letterSpacing:"0.5px",color:"#fff"}},"Delete Load Balancer")),
React.createElement("div",{className:"panel-body",style:{padding:"25px 20px"}},React.createElement("p",null,"Are you sure you want to delete",React.createElement("strong",null,a.name),"?"),React.createElement("p",{className:"text-muted"},React.createElement("small",null,"This action cannot be undone.")),b&&React.createElement("div",{className:"text-center",style:{marginTop:10}},React.createElement("span",{style:{display:"inline-block",width:14,height:14,border:"2px solid #ccc",borderTopColor:"#333",
borderRadius:"50%",animation:"spin 0.8s linear infinite"}})," Deleting...")),React.createElement("div",{className:"panel-footer text-right",style:{background:"#fff",padding:"12px 20px"}},React.createElement("button",{className:"btn btn-default",onClick:c,disabled:b,style:{textTransform:"uppercase",fontWeight:600,fontSize:"0.85em"}},"Cancel"),React.createElement("button",{className:"btn btn-danger",onClick:e,disabled:b,style:{textTransform:"uppercase",fontWeight:600,fontSize:"0.85em",marginLeft:10}},
"Delete")))),Step1_Details=({data:a,update:c,options:e})=>React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Name",required:!0},React.createElement("input",{className:"form-control",value:a.name||"",onChange:b=>c("name",b.target.value),placeholder:"My Load Balancer"}))),React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Description"},React.createElement("input",
{className:"form-control",value:a.description||"",onChange:b=>c("description",b.target.value),placeholder:"Optional description"})))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"VIP Subnet",required:!0},React.createElement("select",{className:"form-control",value:a.vipSubnetId||"",onChange:b=>c("vipSubnetId",b.target.value)},React.createElement("option",{value:!0},"Select Subnet..."),(e.subnets||[]).map(b=>React.createElement("option",
{key:b.value,value:b.value},b.name,b.cidr?`(${b.cidr})`:""))))),React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"IP Address"},React.createElement("input",{className:"form-control",value:a.vipAddress||"",onChange:b=>c("vipAddress",b.target.value),placeholder:"Auto-assign"}))))),Step2_Listener=({data:a,update:c})=>{const e="HTTP HTTPS TERMINATED_HTTPS TCP UDP SCTP".split(" "),b=["HTTP","TERMINATED_HTTPS"].includes(a.listenerProtocol),d="TERMINATED_HTTPS"===a.listenerProtocol,
g=["UDP","SCTP"].includes(a.listenerProtocol);return React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.createListener,onChange:f=>c("createListener",f.target.checked)}),React.createElement("strong",null,"Create Listener"))))),a.createListener&&React.createElement("div",
{style:{borderLeft:"3px solid #ddd",paddingLeft:15,marginLeft:5}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Listener Name",required:!0},React.createElement("input",{className:"form-control",value:a.listenerName||"",onChange:f=>c("listenerName",f.target.value)}))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"Protocol",required:!0},React.createElement("select",{className:"form-control",
value:a.listenerProtocol||"HTTP",onChange:f=>c("listenerProtocol",f.target.value)},e.map(f=>React.createElement("option",{key:f,value:f},f))))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"Port",required:!0},React.createElement("input",{type:"number",className:"form-control",value:a.listenerPort||80,onChange:f=>c("listenerPort",parseInt(f.target.value)),min:"1",max:"65535"})))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},
React.createElement(Field,{label:"Connection Limit"},React.createElement("input",{type:"number",className:"form-control",value:a.connectionLimit||-1,onChange:f=>c("connectionLimit",parseInt(f.target.value)),placeholder:"-1 for infinite"}))),React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Allowed CIDRs"},React.createElement("input",{className:"form-control",value:a.allowedCidrs||"",onChange:f=>c("allowedCidrs",f.target.value),placeholder:"e.g. 192.168.1.0/24, 10.0.0.0/8"})))),
!g&&React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"Client Data Timeout"},React.createElement("input",{type:"number",className:"form-control",value:a.clientDataTimeout||5E4,onChange:f=>c("clientDataTimeout",parseInt(f.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"TCP Inspect Timeout"},React.createElement("input",{type:"number",className:"form-control",value:a.tcpInspectTimeout||
0,onChange:f=>c("tcpInspectTimeout",parseInt(f.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"Member Connect Timeout"},React.createElement("input",{type:"number",className:"form-control",value:a.memberConnectTimeout||5E3,onChange:f=>c("memberConnectTimeout",parseInt(f.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"Member Data Timeout"},React.createElement("input",{type:"number",className:"form-control",
value:a.memberDataTimeout||5E4,onChange:f=>c("memberDataTimeout",parseInt(f.target.value))})))),b&&React.createElement("div",{className:"well ml-3"},React.createElement("label",null,"Insert Headers"),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.insertXForwardedFor||!1,onChange:f=>c("insertXForwardedFor",f.target.checked)})," X-Forwarded-For")),React.createElement("div",{className:"checkbox"},React.createElement("label",
null,React.createElement("input",{type:"checkbox",checked:a.insertXForwardedPort||!1,onChange:f=>c("insertXForwardedPort",f.target.checked)})," X-Forwarded-Port")),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.insertXForwardedProto||!1,onChange:f=>c("insertXForwardedProto",f.target.checked)})," X-Forwarded-Proto"))),d&&React.createElement("div",{className:"well ml-3"},React.createElement("label",null,"TLS Configuration"),
React.createElement(Field,{label:"TLS Cipher String"},React.createElement("input",{className:"form-control",value:a.tlsCipherString||"",onChange:f=>c("tlsCipherString",f.target.value),placeholder:"Default"})))))},Step3_Pool=({data:a,update:c})=>{const e=["ROUND_ROBIN","LEAST_CONNECTIONS","SOURCE_IP"],b=["HTTP","HTTPS","TCP","UDP","SCTP"];return React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12"},
React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.createPool,onChange:d=>c("createPool",d.target.checked)}),React.createElement("strong",null,"Create Pool"))))),a.createPool&&React.createElement("div",{style:{borderLeft:"3px solid #ddd",paddingLeft:15,marginLeft:5}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Pool Name",required:!0},
React.createElement("input",{className:"form-control",value:a.poolName||"",onChange:d=>c("poolName",d.target.value)}))),React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Algorithm",required:!0},React.createElement("select",{className:"form-control",value:a.poolAlgorithm||"ROUND_ROBIN",onChange:d=>c("poolAlgorithm",d.target.value)},e.map(d=>React.createElement("option",{key:d,value:d},d)))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},
React.createElement(Field,{label:"Protocol",required:!0},React.createElement("select",{className:"form-control",value:a.poolProtocol||a.listenerProtocol||"HTTP",onChange:d=>c("poolProtocol",d.target.value)},b.map(d=>React.createElement("option",{key:d,value:d},d))))),React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Description"},React.createElement("input",{className:"form-control",value:a.poolDesc||"",onChange:d=>c("poolDesc",d.target.value)})))),React.createElement("div",
{className:"well"},React.createElement("label",null,"Session Persistence"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Type"},React.createElement("select",{className:"form-control",value:a.sessionPersistence||"None",onChange:d=>c("sessionPersistence",d.target.value)},React.createElement("option",{value:"None"},"None"),React.createElement("option",{value:"SOURCE_IP"},"Source IP"),React.createElement("option",{value:"HTTP_COOKIE"},
"HTTP Cookie"),React.createElement("option",{value:"APP_COOKIE"},"App Cookie")))),"APP_COOKIE"===a.sessionPersistence&&React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Cookie Name",required:!0},React.createElement("input",{className:"form-control",value:a.cookieName||"",onChange:d=>c("cookieName",d.target.value)}))))),React.createElement("div",{className:"well"},React.createElement("label",null,"TLS Encryption (Backend Re-encryption)"),React.createElement("div",{className:"checkbox"},
React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.poolTlsEnabled||!1,onChange:d=>c("poolTlsEnabled",d.target.checked)}),"Enable TLS")),a.poolTlsEnabled&&React.createElement(Field,{label:"Cipher String"},React.createElement("input",{className:"form-control",value:a.poolTlsCipher||"",onChange:d=>c("poolTlsCipher",d.target.value),placeholder:"Default"})))))},Step4_Members=({data:a,update:c,options:e})=>{const [b,d]=React.useState(""),g=(e.instances||[]).filter(k=>
!(a.members||[]).find(h=>h.id===k.value)),[f,q]=React.useState(""),[l,v]=React.useState(80),[r,x]=React.useState(1),t=()=>{if(b){var k=e.instances.find(h=>h.value===b);k={id:k.value,name:k.name,type:"INTERNAL",address:"10.0.0."+Math.floor(255*Math.random()),port:80,weight:1,role:"member"};c("members",[...(a.members||[]),k]);d("")}},m=()=>{if(f){var k={id:"ext-"+Math.floor(1E4*Math.random()),name:f,type:"EXTERNAL",address:f,port:l,weight:r,role:"member"};c("members",[...(a.members||[]),k]);q("")}},
p=k=>{c("members",(a.members||[]).filter(h=>h.id!==k))};return React.createElement("div",null,a.createPool?React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},"Add Instance Member"),React.createElement("div",{className:"panel-body"},React.createElement("div",{className:"input-group"},React.createElement("select",{className:"form-control",
value:b,onChange:k=>d(k.target.value)},React.createElement("option",{value:!0},"Select Instance..."),g.map(k=>React.createElement("option",{key:k.value,value:k.value},k.name))),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-success",onClick:t,disabled:!b},"Add")))))),React.createElement("div",{className:"col-md-6"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},"Add External Member"),
React.createElement("div",{className:"panel-body"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-5"},React.createElement("input",{className:"form-control input-sm",placeholder:"IP Address",value:f,onChange:k=>q(k.target.value)})),React.createElement("div",{className:"col-xs-3"},React.createElement("input",{type:"number",className:"form-control input-sm",placeholder:"Port",value:l,onChange:k=>v(parseInt(k.target.value))})),React.createElement("div",{className:"col-xs-2"},
React.createElement("input",{type:"number",className:"form-control input-sm",placeholder:"Wgt",value:r,onChange:k=>x(parseInt(k.target.value))})),React.createElement("div",{className:"col-xs-2"},React.createElement("button",{className:"btn btn-success btn-sm btn-block",onClick:m,disabled:!f},"Add"))))))),React.createElement("table",{className:"table table-striped table-bordered"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",
null,"Address"),React.createElement("th",null,"Port"),React.createElement("th",null,"Weight"),React.createElement("th",null,"Type"),React.createElement("th",null))),React.createElement("tbody",null,0===(a.members||[]).length?React.createElement("tr",null,React.createElement("td",{colSpan:"6",className:"text-center text-muted"},"No members defined")):(a.members||[]).map(k=>React.createElement("tr",{key:k.id},React.createElement("td",null,k.name),React.createElement("td",null,k.address),React.createElement("td",
null,k.port),React.createElement("td",null,k.weight),React.createElement("td",null,React.createElement(Badge,{text:k.type||"INTERNAL",tone:"EXTERNAL"===k.type?"warning":"info"})),React.createElement("td",{className:"text-right"},React.createElement("button",{className:"btn btn-xs",style:{backgroundColor:"#b00020",color:"#fff",border:"none",fontWeight:600},onClick:()=>p(k.id)},"&times;"))))))):React.createElement("div",{className:"alert alert-warning"},"Pool creation is disabled. No members can be added."))},
Step5_Monitor=({data:a,update:c})=>{const e="HTTP HTTPS PING TCP TLS-HELLO UDP-CONNECT SCTP".split(" ");return React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:a.createMonitor,onChange:b=>c("createMonitor",b.target.checked)}),React.createElement("strong",null,
"Create Health Monitor"))))),a.createMonitor&&React.createElement("div",{style:{borderLeft:"3px solid #ddd",paddingLeft:15,marginLeft:5}},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Name",required:!0},React.createElement("input",{className:"form-control",value:a.monitorName||"",onChange:b=>c("monitorName",b.target.value)}))),React.createElement("div",{className:"col-md-6"},React.createElement(Field,{label:"Type",required:!0},
React.createElement("select",{className:"form-control",value:a.monitorType||"HTTP",onChange:b=>c("monitorType",b.target.value)},e.map(b=>React.createElement("option",{key:b,value:b},b)))))),("HTTP"===a.monitorType||"HTTPS"===a.monitorType)&&React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-4"},React.createElement(Field,{label:"HTTP Method"},React.createElement("select",{className:"form-control",value:a.httpMethod||"GET",onChange:b=>
c("httpMethod",b.target.value)},"GET HEAD POST PUT DELETE TRACE OPTIONS PATCH CONNECT".split(" ").map(b=>React.createElement("option",{key:b,value:b},b))))),React.createElement("div",{className:"col-md-4"},React.createElement(Field,{label:"Expected Codes"},React.createElement("input",{className:"form-control",value:a.expectedCodes||"200",onChange:b=>c("expectedCodes",b.target.value),placeholder:"200, 200-204"}))),React.createElement("div",{className:"col-md-4"},React.createElement(Field,{label:"URL Path"},
React.createElement("input",{className:"form-control",value:a.urlPath||"/",onChange:b=>c("urlPath",b.target.value),placeholder:"/"}))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"Delay (sec)",required:!0},React.createElement("input",{type:"number",className:"form-control",value:a.delay||5,onChange:b=>c("delay",parseInt(b.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,
{label:"Timeout (sec)",required:!0},React.createElement("input",{type:"number",className:"form-control",value:a.timeout||5,onChange:b=>c("timeout",parseInt(b.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,{label:"Max Retries",required:!0},React.createElement("input",{type:"number",className:"form-control",value:a.maxRetries||3,onChange:b=>c("maxRetries",parseInt(b.target.value))}))),React.createElement("div",{className:"col-md-3"},React.createElement(Field,
{label:"Max Retries Down"},React.createElement("input",{type:"number",className:"form-control",value:a.maxRetriesDown||3,onChange:b=>c("maxRetriesDown",parseInt(b.target.value))}))))))},CreateWizard=({networkId:a,options:c,onCreated:e,onClose:b})=>{const [d,g]=React.useState(1),[f,q]=React.useState(""),[l,v]=React.useState({networkId:a,createListener:!0,createPool:!0,createMonitor:!0,listenerProtocol:"HTTP",listenerPort:80,poolProtocol:"HTTP",poolAlgorithm:"ROUND_ROBIN",monitorType:"HTTP",members:[]});
React.useEffect(()=>{0<c.subnets?.length&&!l.vipSubnetId&&v(h=>({...h,vipSubnetId:c.subnets[0].value}))},[c.subnets]);const [r,x]=React.useState(!1),t=h=>{if(1===h){if(!l.name||!l.name.trim())return"Name is required";if(!l.vipSubnetId)return"VIP Subnet is required"}if(2===h&&l.createListener){if(!l.listenerName||!l.listenerName.trim())return"Listener Name is required";if(!l.listenerProtocol)return"Protocol is required";const n=parseInt(l.listenerPort);if(!l.listenerPort||isNaN(n)||1>n||65535<n)return"Port must be between 1 and 65535"}if(3===
h&&l.createPool){if(!l.poolName||!l.poolName.trim())return"Pool Name is required";if(!l.poolAlgorithm)return"Algorithm is required"}if(5===h&&l.createMonitor){if(!l.monitorName||!l.monitorName.trim())return"Monitor Name is required";if(!l.monitorType)return"Monitor Type is required"}return null};a=()=>{const h=t(d);h?q(h):(q(""),g(n=>n+1))};const m=()=>{var h=t(d);h?q(h):(x(!0),h={...l},h.createListener||(delete h.listenerName,delete h.listenerProtocol),h.createPool||(delete h.members,delete h.poolName),
h.createMonitor||delete h.monitorName,Api.createLoadBalancer(h).then(n=>{x(!1);n.success?e():alert(n.message||"Error creating LB")}).catch(n=>{x(!1);alert(n.message)}))},p=[{num:1,title:"Load Balancer Details",comp:Step1_Details},{num:2,title:"Listener Details",comp:Step2_Listener},{num:3,title:"Pool Details",comp:Step3_Pool},{num:4,title:"Pool Members",comp:Step4_Members},{num:5,title:"Monitor Details",comp:Step5_Monitor}],k=p.find(h=>h.num===d).comp;return React.createElement("div",{style:{position:"fixed",
top:0,left:0,right:0,bottom:0,zIndex:1100,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center"}},React.createElement("div",{style:{width:"100%",maxWidth:900,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 5px 30px rgba(0,0,0,0.4)",borderRadius:0,overflow:"hidden"}},React.createElement("div",{style:{background:"#f9c600",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:48}},React.createElement("span",
{style:{color:"#fff",fontWeight:700,fontSize:"14px",textTransform:"uppercase",letterSpacing:"1px"}},"Create Load Balancer"),React.createElement("button",{onClick:b,style:{background:"none",border:"none",color:"#fff",fontSize:24,cursor:"pointer",lineHeight:1,padding:"0 4px"}},"\u00d7")),React.createElement("div",{style:{background:"#fff",borderBottom:"2px solid #e1e3e5",padding:"0 20px",display:"flex",alignItems:"center",minHeight:42}},p.map((h,n)=>{const u=d===h.num,w=h.num<d;return React.createElement(React.Fragment,
{key:h.num},0<n&&React.createElement("span",{style:{margin:"0 8px",color:"#ccc",fontSize:11}},">"),React.createElement("span",{style:{fontSize:"12px",textTransform:"uppercase",fontWeight:u?700:400,color:u?"#2d353c":w?"#2d353c":"#aaa",cursor:w?"pointer":"default",letterSpacing:"0.5px"},onClick:()=>{w&&(q(""),g(h.num))}},h.title))})),React.createElement("div",{style:{flex:1,background:"#fff",overflowY:"auto",padding:"25px 30px"}},f&&React.createElement("div",{className:"alert alert-danger",style:{marginBottom:15}},
f),React.createElement(k,{data:l,update:(h,n)=>{v(u=>({...u,[h]:n}));q("")},options:c})),React.createElement("div",{style:{background:"#fff",borderTop:"1px solid #e1e3e5",padding:"12px 20px",display:"flex",justifyContent:"flex-end",gap:10}},1<d&&React.createElement("button",{className:"btn btn-default",onClick:()=>{q("");g(h=>h-1)},style:{textTransform:"uppercase",fontWeight:600,fontSize:"0.85em",padding:"8px 20px"}},"Previous"),5>d&&React.createElement("button",{className:"btn",style:{backgroundColor:"#f9c600",
color:"#000",border:"none",fontWeight:600,textTransform:"uppercase",fontSize:"0.85em",padding:"8px 24px"},onClick:a},"Next"),5===d&&React.createElement("button",{className:"btn",style:{backgroundColor:"#f9c600",color:"#000",border:"none",fontWeight:600,textTransform:"uppercase",fontSize:"0.85em",padding:"8px 24px"},onClick:m,disabled:r},r?"Creating...":"Finish"))))},EditLBModal=({lb:a,networkId:c,onClose:e,onUpdated:b})=>{const [d,g]=React.useState("general"),[f,q]=React.useState(!0),[l,v]=React.useState(!1),
[r,x]=React.useState({});React.useEffect(()=>{q(!0);const m={networkId:c};Promise.all([Api.listListeners(a.id,m),Api.listPools(a.id,m),Api.getHealthMonitor(a.id,m)]).then(([p,k,h])=>{const n=p.listeners?.[0]||{},u=k.pools?.[0]||{},w=h.monitor||{};x({name:a.name,description:a.description,admin_state_up:!1!==a.admin_state_up,createListener:!!p.listeners?.length,listenerName:n.name,listenerProtocol:n.protocol,listenerPort:n.protocolPort,connectionLimit:n.connectionLimit,allowedCidrs:n.allowedCidrs,insertXForwardedFor:n.insertXForwardedFor,
insertXForwardedPort:n.insertXForwardedPort,insertXForwardedProto:n.insertXForwardedProto,tlsCipherString:n.tlsCipherString,createPool:!!k.pools?.length,poolName:u.name,poolAlgorithm:u.lbAlgorithm,poolDesc:u.description,sessionPersistence:u.sessionPersistence,cookieName:u.cookieName,poolTlsEnabled:u.tlsEnabled,poolTlsCipher:u.tlsCipherString,members:(u.members||[]).map(y=>({...y,type:y.type||"INTERNAL"})),createMonitor:!!h.monitor,monitorName:w.name,monitorType:w.type,delay:w.delay,timeout:w.timeout,
maxRetries:w.maxRetries,httpMethod:w.httpMethod,urlPath:w.urlPath,expectedCodes:w.expectedCodes});q(!1)}).catch(p=>{alert("Error loading details: "+p.message);e()})},[a.id]);const t=(m,p)=>x(k=>({...k,[m]:p}));return React.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1100,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center"}},React.createElement("div",{style:{width:"100%",maxWidth:900,maxHeight:"90vh",display:"flex",flexDirection:"column",
boxShadow:"0 5px 30px rgba(0,0,0,0.4)",borderRadius:0,overflow:"hidden"}},React.createElement("div",{style:{background:"#f9c600",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:48}},React.createElement("span",{style:{color:"#fff",fontWeight:700,fontSize:"14px",textTransform:"uppercase",letterSpacing:"1px"}},"Edit Load Balancer"),React.createElement("button",{onClick:e,style:{background:"none",border:"none",color:"#fff",fontSize:24,cursor:"pointer",lineHeight:1,
padding:"0 4px"}},"\u00d7")),React.createElement("div",{style:{background:"#fff",borderBottom:"2px solid #e1e3e5",padding:"0 20px",display:"flex",alignItems:"center",minHeight:42}},[{key:"general",title:"General"},{key:"listener",title:"Listener"},{key:"pool",title:"Pool & Members"},{key:"monitor",title:"Monitor"}].map((m,p)=>{const k=d===m.key;return React.createElement(React.Fragment,{key:m.key},0<p&&React.createElement("span",{style:{margin:"0 8px",color:"#ccc",fontSize:11}},">"),React.createElement("span",
{style:{fontSize:"12px",textTransform:"uppercase",fontWeight:k?700:400,color:k?"#2d353c":"#aaa",cursor:"pointer",letterSpacing:"0.5px"},onClick:()=>g(m.key)},m.title))})),React.createElement("div",{style:{flex:1,background:"#fff",overflowY:"auto",padding:"25px 30px"}},f?React.createElement("div",{style:{textAlign:"center",padding:40}},React.createElement("span",{style:{display:"inline-block",width:16,height:16,border:"2px solid #ccc",borderTopColor:"#333",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),
" Loading..."):React.createElement("div",null,"general"===d&&React.createElement("div",{className:"form-horizontal"},React.createElement(Field,{label:"Name"},React.createElement("input",{className:"form-control",value:r.name||"",onChange:m=>t("name",m.target.value)})),React.createElement(Field,{label:"Description"},React.createElement("input",{className:"form-control",value:r.description||"",onChange:m=>t("description",m.target.value)})),React.createElement("div",{className:"form-group"},React.createElement("div",
{className:"col-sm-12"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:r.admin_state_up,onChange:m=>t("admin_state_up",m.target.checked)})," Admin State Up"))))),"listener"===d&&React.createElement(Step2_Listener,{data:r,update:t}),"pool"===d&&React.createElement("div",null,React.createElement(Step3_Pool,{data:r,update:t}),React.createElement("hr",null),React.createElement("h5",{style:{textTransform:"uppercase",
fontWeight:600,marginBottom:15}},"Members"),React.createElement(Step4_Members,{data:r,update:t,options:{instances:[]}})),"monitor"===d&&React.createElement(Step5_Monitor,{data:r,update:t}))),React.createElement("div",{style:{background:"#fff",borderTop:"1px solid #e1e3e5",padding:"12px 20px",display:"flex",justifyContent:"flex-end",gap:10}},React.createElement("button",{className:"btn btn-default",onClick:e,style:{textTransform:"uppercase",fontWeight:600,fontSize:"0.85em",padding:"8px 20px"}},"Cancel"),
React.createElement("button",{className:"btn",style:{backgroundColor:"#f9c600",color:"#000",border:"none",fontWeight:600,textTransform:"uppercase",fontSize:"0.85em",padding:"8px 24px"},onClick:()=>{v(!0);Api.updateLoadBalancer(a.id,{...r,networkId:c}).then(m=>{v(!1);m.success?b():alert(m.message)}).catch(m=>{v(!1);alert(m.message)})},disabled:l||f},l?"Saving...":"Save Changes"))))},NetworkView=({networkId:a})=>{const [c,e]=React.useState("list"),[b,d]=React.useState(null),[g,f]=React.useState(null);
var q=useAsync(()=>Api.listOptions(a),[a]),l=useAsync(()=>Api.listLoadBalancers({networkId:a}),[a,g]);const [v,r]=React.useState(null),[x,t]=React.useState(!1);if(l.error)return React.createElement("div",{className:"alert alert-danger"},l.error.message);if(l.loading||q.loading)return React.createElement("div",{style:{padding:20}},React.createElement("i",{className:"fa fa-spinner fa-spin"})," Loading...");l=l.data.loadbalancers||[];q=q.data||{};const m=()=>{t(!0);Api.deleteLoadBalancer(v.id,a).then(()=>
{t(!1);r(null);f({msg:"Load Balancer deleted successfully.",type:"success"})})};return React.createElement("div",{style:{padding:"0"}},g&&React.createElement(Toast,{msg:g.msg,type:g.type,onClose:()=>f(null)}),v&&React.createElement(DeleteConfirmModal,{lb:v,loading:x,onClose:()=>r(null),onConfirm:m}),"create"===c&&React.createElement(CreateWizard,{networkId:a,options:q,onClose:()=>e("list"),onCreated:()=>{e("list");f({msg:"Load Balancer created.",type:"success"})}}),"edit"===c&&b&&React.createElement(EditLBModal,
{lb:b,networkId:a,onClose:()=>{d(null);e("list")},onUpdated:()=>{d(null);e("list");f({msg:"Load Balancer updated.",type:"success"})}}),React.createElement("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:15,padding:"0 5px"}},React.createElement("button",{className:"btn",style:{backgroundColor:"#f9c600",color:"#000",border:"none",fontWeight:600,textTransform:"uppercase",padding:"6px 14px",fontSize:"0.85em"},onClick:()=>e("create")},React.createElement("i",{className:"fa fa-plus",
style:{marginRight:5}})," Add")),React.createElement("table",{className:"table",style:{borderCollapse:"collapse"}},React.createElement("thead",null,React.createElement("tr",{style:{borderBottom:"2px solid #e1e3e5"}},React.createElement("th",{style:{textTransform:"uppercase",fontSize:"0.8em",fontWeight:600,color:"#555",letterSpacing:"0.5px",padding:"10px 12px"}},"Name"),React.createElement("th",{style:{textTransform:"uppercase",fontSize:"0.8em",fontWeight:600,color:"#555",letterSpacing:"0.5px",padding:"10px 12px"}},
"VIP"),React.createElement("th",{style:{textTransform:"uppercase",fontSize:"0.8em",fontWeight:600,color:"#555",letterSpacing:"0.5px",padding:"10px 12px"}},"Status"),React.createElement("th",{style:{textTransform:"uppercase",fontSize:"0.8em",fontWeight:600,color:"#555",letterSpacing:"0.5px",padding:"10px 12px"}},"Members"),React.createElement("th",{style:{textTransform:"uppercase",fontSize:"0.8em",fontWeight:600,color:"#555",letterSpacing:"0.5px",padding:"10px 12px",width:80}}))),React.createElement("tbody",
null,l.map(p=>React.createElement("tr",{key:p.id,style:{borderBottom:"1px solid #eee"}},React.createElement("td",{style:{padding:"12px",verticalAlign:"middle",fontWeight:500,color:"#333"}},p.name),React.createElement("td",{style:{padding:"12px",verticalAlign:"middle",color:"#555"}},p.vipAddress),React.createElement("td",{style:{padding:"12px",verticalAlign:"middle"}},React.createElement(Badge,{text:p.provisioning_status,tone:"ACTIVE"===p.provisioning_status?"success":"warning"})),React.createElement("td",
{style:{padding:"12px",verticalAlign:"middle",color:"#555"}},(p.members||[]).length),React.createElement("td",{style:{padding:"12px",verticalAlign:"middle",textAlign:"right",whiteSpace:"nowrap"}},React.createElement("button",{className:"btn btn-default btn-sm",style:{marginRight:6,padding:"3px 8px",fontSize:"12px"},title:"Edit",onClick:()=>{d(p);e("edit")}},React.createElement("i",{className:"fas fa-pencil-alt"})),React.createElement("button",{className:"btn btn-danger btn-sm",style:{padding:"3px 8px",
fontSize:"12px"},title:"Delete",onClick:()=>r(p)},React.createElement("i",{className:"fas fa-trash-alt"}))))))),0===l.length&&React.createElement("div",{style:{textAlign:"center",padding:"30px 0",color:"#999"}},'No Load Balancers found. Click "+ Add" to create one.'))},InstanceView=({instanceId:a})=>{var c=useAsync(()=>Api.listLoadBalancers({instanceId:a}),[a]);if(c.error)return React.createElement("div",{className:"alert alert-danger"},c.error.message);if(c.loading)return React.createElement("div",
{style:{padding:20,textAlign:"center"}},React.createElement("span",{style:{display:"inline-block",width:16,height:16,border:"2px solid #ccc",borderTopColor:"#333",borderRadius:"50%",animation:"spin 0.8s linear infinite"}})," Loading...");c=c.data?.loadbalancers||[];return 0===c.length?React.createElement("div",{className:"alert alert-info"},"This instance is not a member of any Octavia load balancer."):React.createElement("div",{className:"container-fluid",style:{padding:"0 12px"}},React.createElement("h4",
{style:{textTransform:"uppercase",fontWeight:600,letterSpacing:"0.5px",color:"#2d6ca2",marginBottom:15}},"Load balancers associated with this instance"),React.createElement("p",{className:"text-muted",style:{marginBottom:15,fontSize:"0.9em"}},"This instance is a pool member of the following load balancers. Click a name to manage it on the Network detail page."),React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",
null,React.createElement("tr",{style:{textTransform:"uppercase",fontSize:"0.85em",fontWeight:600}},React.createElement("th",null,"Name"),React.createElement("th",null,"VIP"),React.createElement("th",null,"Status"),React.createElement("th",null,"Members"),React.createElement("th",null,"Network"))),React.createElement("tbody",null,c.map(e=>React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{href:"/infrastructure/networks/"+(e.networkId||"")+"#!octavia-network-tab",
style:{fontWeight:"bold",color:"#2d6ca2",textDecoration:"none"},title:"View in Network detail Octavia tab"},e.name)),React.createElement("td",null,e.vipAddress),React.createElement("td",null,React.createElement(Badge,{text:e.provisioning_status||"ACTIVE",tone:"ACTIVE"===(e.provisioning_status||"ACTIVE")?"success":"warning"})),React.createElement("td",null,(e.members||[]).length),React.createElement("td",null,React.createElement("a",{href:"/infrastructure/networks/"+(e.networkId||""),style:{color:"#2d6ca2"}},
e.networkName||"View Network"))))))))},App=()=>{var a=document.getElementById("octavia-loadbalancer-view"),c=a?.dataset.model;a=a?.dataset.id;if(!c||!a){var e=window.location.pathname.split("/").filter(Boolean);const b=e.indexOf("instances"),d=e.indexOf("networks");-1!==b&&e[b+1]?(c="instance",a=e[b+1]):-1!==d&&e[d+1]&&(c="network",a=e[d+1])}e="network"===c?a:null;c="instance"===c?a:null;return e?React.createElement(NetworkView,{networkId:e}):c?React.createElement(InstanceView,{instanceId:c}):React.createElement("div",
{className:"alert alert-warning"},"Context missing.")};ReactDOM.createRoot?ReactDOM.createRoot(mountNode).render(React.createElement(App,null)):ReactDOM.render(React.createElement(App,null),mountNode);